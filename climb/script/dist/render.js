const canvas=document.getElementById("screen"),ctx=canvas.getContext("2d");ctx.imageSmoothingEnabled=!1;export const SCREEN_SIZE_X=15;export const SCREEN_SIZE_Y=12;export const TILE_SIZE=22;export function GetTilePos(t,e){const a=canvas.width/15,o=canvas.height/12,n=Math.floor(7*a);return{x:Math.ceil(n+t*a),y:Math.ceil(e*o),w:Math.ceil(a),h:Math.ceil(o)}}export const BG_tile_imgs={isLoaded:!1};export const Char_tile_imgs={isLoaded:!1};export const Dialog_tile_imgs={isLoaded:!1};const BGimg=new Image;BGimg.src="./Assets/Image/BG.png";const Dialogimg=new Image;Dialogimg.src="./Assets/Image/dialog.png";const Charimg_cup=new Image,Charimg_kris=new Image;function createTile(t,e,a,o,n,i=1){const s=document.createElement("canvas");s.width=Math.round(o*i),s.height=Math.round(n*i);const c=s.getContext("2d");return c.imageSmoothingEnabled=!1,c.drawImage(t,Math.round(e),Math.round(a),Math.round(o),Math.round(n),0,0,s.width,s.height),s}function OnImageLoad(t,e,a,o,n=0){let i=n;for(let n=0;n<o;n++)for(let o=0;o<a;o++)e[i++]=createTile(t,22*o,22*n,22,22)}BGimg.onload=()=>{OnImageLoad(BGimg,BG_tile_imgs,24,25),BG_tile_imgs.isLoaded=!0},Dialogimg.onload=()=>{OnImageLoad(Dialogimg,Dialog_tile_imgs,4,3),Dialog_tile_imgs.isLoaded=!0},Charimg_cup.onload=()=>{OnImageLoad(Charimg_cup,Char_tile_imgs,8,2),Charimg_kris.onload=()=>{OnImageLoad(Charimg_kris,Char_tile_imgs,8,3,Object.keys(Char_tile_imgs).length-1),Char_tile_imgs.isLoaded=!0},Charimg_kris.src="./Assets/Image/kris.png"},Charimg_cup.src="./Assets/Image/cuptain.png";export function clearScreen(){ctx.clearRect(0,0,canvas.width,canvas.height)}export function DrawTile(t,e,a,o=!1,n=!1){if(!t)return;const i=GetTilePos(e,a);ctx.save(),ctx.translate(i.x+i.w/2,i.y+i.h/2),ctx.scale(o?-1:1,n?-1:1),ctx.imageSmoothingEnabled=!1,ctx.drawImage(t,-i.w/2,-i.h/2,i.w,i.h),ctx.restore()}const texts=new Map;function createUUID(){return crypto.randomUUID()}function getTileSize(){return Math.floor(canvas.width/15)}function getFontSize(t){return Math.max(1,Math.floor(getTileSize()*t))}export function applyRenderState(){ctx.setTransform(1,0,0,1,0,0),ctx.imageSmoothingEnabled=!1,ctx.fillStyle="#fff",ctx.textBaseline="top",ctx.textAlign="left"}async function startFontSystem(){await document.fonts.ready}startFontSystem();export function addText(t,e,a,o=1){const n=createUUID();return texts.set(n,{id:n,text:t,x:e,y:a,scale:o}),n}export function removeText(t){texts.delete(t)}export function replaceText(t,e,a,o,n){const i=texts.get(t);i&&(i.text=e,i.x=a,i.y=o,void 0!==n&&(i.scale=n))}export function drawTexts(){if(0!==texts.size)for(const t of texts.values()){const e=GetTilePos(t.x,t.y),a=getFontSize(t.scale);ctx.font=`${a}px Font`,ctx.fillText(t.text,Math.floor(e.x),Math.floor(e.y))}}