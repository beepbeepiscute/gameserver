import{BG_tile_imgs,DrawTile,clearScreen,Dialog_tile_imgs,addText,removeText,drawTexts,applyRenderState}from"./render.js";import{Map}from"./map.js";import{Player}from"./player.js";const gameSetting={boostmode:!1},player=new Player,camera={x:0,y:0},map=new Map;function drawMap(e,t,a=0,r=0){for(const[s,i]of Object.entries(t)){const t=parseInt(s,16);if(!(t>12))for(let s=e.x-7;s<=e.x+7;s++){const e=i[s];if("number"==typeof e)DrawTile(BG_tile_imgs[e],s+a,t+r);else if(null!==e&&"object"==typeof e){const i=e.id,o=e.xflip,l=e.yflip;if("number"!=typeof i)continue;DrawTile(BG_tile_imgs[i],s+a,t+r,o,l)}}}}function drawDialog(e="base"){let t;if("base"==e)t={8:[10,0,4,4,4,4,4,4,4,4,4,4,4,1,10],9:[10,7,8,8,8,8,8,8,8,8,8,8,8,5,10],A:[10,7,8,8,8,8,8,8,8,8,8,8,8,5,10],B:[10,2,6,6,6,6,6,6,6,6,6,6,6,3,10]};else if("setting"==e)t={};else{if("charSelect"!=e)return;t={}}for(const[e,a]of Object.entries(t)){const t=parseInt(e,16);t>12||a.forEach((e,a)=>{DrawTile(Dialog_tile_imgs[e],a-7,t)})}}let lastTime=performance.now(),tick=0,base_start_uuid=addText("   [시작]",-5,8.9,.65),base_char_uuid=addText("   [캐릭터]",-5,9.7,.65),base_setting_uuid=addText("   [설정]",-5,10.5,.65),select="start",dialogscreen="base",gameStartAnimated=!1;function onKeyDown(e){console.log(e),"ArrowUp"==e.key?"base"==dialogscreen&&("start"==select?select="setting":"char"==select?select="start":"setting"==select&&(select="char")):"ArrowDown"==e.key?"base"==dialogscreen&&("start"==select?select="char":"char"==select?select="setting":"setting"==select&&(select="start")):"z"==e.key&&"base"==dialogscreen&&"start"==select&&(dialogscreen="gameStart",player.is_start=!0,removeText(base_start_uuid),removeText(base_char_uuid),removeText(base_setting_uuid))}function gameLoop(e){requestAnimationFrame(gameLoop),lastTime=e,tick++,(tick%2!=0||gameSetting.boostmode)&&(clearScreen(),applyRenderState(),drawMap(camera,map.data),player.CharacterDraw(),player.is_start||(drawDialog(),"base"==dialogscreen&&("start"==select?DrawTile(Dialog_tile_imgs[9],-5.3,8.7):"char"==select?DrawTile(Dialog_tile_imgs[9],-5.3,9.5):"setting"==select&&DrawTile(Dialog_tile_imgs[9],-5.3,10.3))),drawTexts())}window.addEventListener("keydown",onKeyDown),requestAnimationFrame(gameLoop);